# Subway Passenger Flow Forecasting System

A Django web application powered by machine learning to predict urban transit traffic. This system forecasts the number of passengers entering and exiting a subway station based on the stop name, line, hour, and day.

## Abstract

With the escalating demand for efficient urban transportation systems, accurate forecasting of subway passenger traffic has become paramount for both commuters and city planners. This project introduces a Django-based web application designed to predict subway traffic using various input parameters such as stop name, line, hour, and day. The core of the application is powered by a pre-trained machine learning model capable of forecasting the number of passengers entering and leaving each subway stop.

The significance of this project lies in its potential to enhance the passenger experience by providing real-time traffic predictions, which can help commuters plan their journeys more effectively and avoid congested stations. Additionally, the application supports subway operators in optimizing their operations, such as scheduling trains more efficiently and managing resources better to accommodate passenger flows.

Key features of the application include an intuitive user interface that allows users to input their desired parameters through a simple form. The backend processes these inputs and utilizes the machine learning model to generate accurate predictions, which are then displayed in a clear and accessible format. This not only makes the tool user-friendly but also ensures that the information is easily interpretable for users of all backgrounds.

Moreover, the applicationâ€™s predictive capabilities are built upon a robust dataset encompassing historical passenger flow data, line-specific information, and temporal factors. By integrating these diverse data sources, the machine learning model achieves high accuracy in its forecasts. This integration of data is facilitated by advanced techniques such as embedding methods and hierarchical attention mechanisms, which allow the model to capture complex patterns and relationships within the data.

Through this project, we aim to contribute to the broader vision of smart city initiatives by enabling more informed decision-making in urban transit systems. The insights generated by the application can be invaluable for municipal authorities in designing better infrastructure and policies to meet the growing needs of urban populations. Furthermore, the visualization of predicted traffic patterns helps in understanding the impact of different factors on subway usage, thereby supporting strategic planning and development.

-----

## System Architecture

The diagram below illustrates the complete workflow of the Subway Passenger Flow Forecasting System, from initial data processing to the final user-facing visualizations.

<img width="1102" height="532" alt="image" src="https://github.com/user-attachments/assets/1a85f504-0c35-4a9b-b0a1-e280f34865f2" />

-----

## How It Works

1.  **Data Loading and Preprocessing:**

      * **Dataset Loading:** The `NYC_subway_traffic_2017-2021.csv` dataset, containing historical subway passenger flow data, is loaded using Pandas.
      * **Data Preprocessing:** The `Datetime` column is feature-engineered to extract `Hour` and `Day`. Categorical data like `Stop Name` and `Line` are mapped to integer values and saved in JSON files (`stop_name_mapping.json`, `line_name_mapping.json`) for the web app to use.

2.  **Model Training with Machine Learning:**

      * **Algorithm Selection:** The system uses `RandomForestRegressor` from Scikit-learn, chosen for its effectiveness in regression tasks. (The `dataexp.ipynb` notebook also explores `LinearRegression` and `XGBRegressor`).
      * **Model Training:** The `RandomForestRegressor` model is trained on the preprocessed dataset to predict `Entries` and `Exits` based on `Stop Name`, `Line`, `Hour`, and `Day`.

3.  **Model Serialization with Joblib:**

      * **Saving the Model:** Once trained, the final Random Forest model is serialized and saved as `traffic_predictor` using Joblib. This allows the model to be loaded directly into the Django application without retraining.

4.  **Integration with Django Web Application:**

      * **Form Submission:** Users interact with the Django frontend, selecting a station, line, hour, and day from a web form (`predict_traffic.html`).
      * **Data Prediction:** The `views.py` backend receives the form data, loads the pre-trained `traffic_predictor` model, and predicts passenger counts. It generates three types of predictions:
        1.  The specific forecast for the selected hour.
        2.  A 24-hour forecast for the selected day.
        3.  A 7-day forecast for the selected hour.

5.  **Visualization Using Chart.js:**

      * **Bar Graphs and Pie Charts:** The predicted passenger numbers are passed to the `prediction_result.html` template.
      * **User Interface:** Chart.js renders the 24-hour and 7-day forecast data as interactive bar graphs and pie charts, providing a clear visual representation of traffic patterns.

-----

## Key Features

  * **Intuitive User Interface:** A simple web form to input stop name, line, hour, and day.
  * **ML-Powered Predictions:** Forecasts the number of passengers entering and leaving a station using a pre-trained Random Forest model.
  * **Dynamic Data Visualization:** Presents results with interactive bar graphs and pie charts using Chart.js.
  * **Hourly & Weekly Analysis:** Provides predictions for the specific time requested, as well as a full 24-hour forecast for the selected day and a 7-day forecast for the selected week.
  * **Scalable Architecture:** Built with Django, allowing for robust backend processing and easy expansion.

-----

## Tech Stack

  * **Backend:** Django
  * **Machine Learning:** Scikit-learn (`RandomForestRegressor`), XGBoost
  * **Data Handling:** Pandas, Joblib (for model serialization)
  * **Frontend:** HTML, CSS, JavaScript, jQuery
  * **Visualization:** Chart.js
  * **Database:** Django ORM (SQLite default)

-----

## Installation and Setup

Follow these steps to set up and run the project locally.

### 1\. Prerequisites

  * Python (3.8 or later)
  * `pip` (Python package installer)
  * Git

### 2\. Clone the Repository

```bash
git clone https://github.com/your-username/your-repository-name.git
cd your-repository-name
```

### 3\. Set Up a Virtual Environment

It's highly recommended to use a virtual environment to manage project dependencies.

```bash
# Create a virtual environment
python -m venv env

# Activate the environment
# On Windows:
.\env\Scripts\activate
# On macOS/Linux:
source env/bin/activate
```

### 4\. Install Dependencies

Install all required Python libraries.

```bash
pip install Django pandas scikit-learn xgboost joblib
```

*(**Note:** For a production setup, it's best to have these listed in a `requirements.txt` file and run `pip install -r requirements.txt`)*

### 5\. Prepare the Data and Train the Model

You must run the model training notebook to generate the model file and JSON mappings used by the Django app.

1.  Place your dataset (`NYC_subway_traffic_2017-2021.csv`) in the project's root directory.
2.  Run the `data.ipynb` Jupyter Notebook. This will:
      * Load and preprocess the data.
      * Train the `RandomForestRegressor` model.
      * Save the model as `traffic_predictor`.
      * Save the mappings as `line_name_mapping.json` and `stop_name_mapping.json`.

### 6\. Set Up the Django Application

1.  **Apply Migrations:** Create the database schema for the `TrafficPrediction` model.

    ```bash
    python manage.py migrate
    ```

2.  **Run the Server:** Start the Django development server.

    ```bash
    python manage.py runserver
    ```

### 7\. Access the Application

Open your web browser and navigate to `http://127.0.0.1:8000/` (or the specific URL you have configured for the `predict_traffic` view). You should see the prediction form.

-----
